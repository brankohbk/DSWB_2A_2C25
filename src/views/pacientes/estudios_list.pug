extends ../layout
block content
    h2 #{title}
    p Paciente: #{paciente.nombre} #{paciente.apellido} (DNI: #{paciente.dni})
    
    a(href=`/pacientes/${paciente._id}/estudios/nuevo`, class="btn btn-green") &plus; Cargar Nuevo Estudio
    a(href='/pacientes', class="btn") â† Volver a Pacientes

    if historial && historial.length
        div(class="table-container" style="margin-top: 20px;")
            table(border='1' cellpadding='6')
                thead
                    tr
                        th Tipo de Estudio
                        th Fecha de Carga
                        th Cargado por
                        th Observaciones
                        th Archivo
                        th Eliminar
                tbody
                    each r in historial
                        tr
                            td= r.tipoEstudio
                            td= new Date(r.fechaCarga).toLocaleDateString('es-AR')
                            td= r.empleado ? r.empleado.nombre : 'N/A'
                            td= r.observaciones || '-'
                            td 
                                // El archivo se guarda en public/uploads/
                                a(href=`${baseUrl}${r.nombreArchivo}`, target="_blank", class="btn btn-blue") ğŸ“„ Ver PDF
                            td
                                form(data-ajax data-redirect=`/pacientes/${paciente._id}/estudios` method='post', action=`/api/resultados/${r._id}?_method=DELETE`, style='display:inline')
                                    button(type='submit', class="btn btn-red", onclick=`return confirm("Â¿Eliminar registro y archivo?")`) ğŸ—‘ï¸
    else
        p No hay resultados de estudios cargados para este paciente.